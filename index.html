<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WellTask</title>

  <!-- Tailwind + Lucide -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            gray: { 750: "#2d3748" }
          }
        }
      }
    };
  </script>

  <!-- Scrollbar styling -->
  <style>
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 4px; }
    .dark ::-webkit-scrollbar-thumb { background: #4a5568; }
  </style>

  <!-- âœ… Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

  <script>
    // âœ… Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCaVEmWvh0_hcxFJQG00QAXNxRsIMpgy94",
      authDomain: "welltask-8bbcf.firebaseapp.com",
      projectId: "welltask-8bbcf",
      storageBucket: "welltask-8bbcf.firebasestorage.app",
      messagingSenderId: "533119656804",
      appId: "1:533119656804:web:ec296e70c7b7e5746c1071",
      measurementId: "G-3HD74YPC52"
    };

    // âœ… Init Firebase + Firestore
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    console.log("ðŸ”¥ Firebase initialized with project:", firebaseConfig.projectId);
  </script>
</head>

<body class="bg-gray-50 text-gray-800 transition-colors duration-200">
  <div id="app"></div>

  <script>
    // ==========================
    // CONFIG
    // ==========================
    // We NO LONGER use Zoho proxy for DB
    // const ZOHO_API_URL = "/api/proxy";

    console.log("ðŸ’¾ Firestore db available?", !!db);

    // Read URL params from widget URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get("token");
    const boardidFromUrl = urlParams.get("boardid"); // channel-based board id

    let currentUser = null;
    let boardid = boardidFromUrl || null;

    // Decode token: email::user_id::boardid (if present)
    if (token) {
      try {
        const decoded = atob(token);
        const parts = decoded.split("::");
        console.log("ðŸ” Decoded token parts:", parts);
        if (parts.length >= 2) {
          currentUser = {
            id: parts[1],
            name: parts[0].split("@")[0],
            email: parts[0]
          };
        }
        if (!boardid && parts.length >= 3) {
          boardid = parts[2];
        }
      } catch (e) {
        console.error("Auth Failed", e);
      }
    }

    const uid = () =>
      Date.now().toString() + Math.floor(Math.random() * 1000);

    // Use boardid for shared board; fallback to user email for personal
    function getStorageKey() {
      if (boardid) {
        return `welltask_state_${boardid}`;
      }
      return currentUser ? `welltask_state_${currentUser.email}` : null;
    }

    function priorityClass(priority) {
      switch (priority) {
        case "Critical":
          return "bg-red-100 text-red-800 dark:bg-red-500/20 dark:text-red-300";
        case "High":
          return "bg-orange-100 text-orange-800 dark:bg-orange-500/20 dark:text-orange-300";
        case "Medium":
          return "bg-yellow-100 text-yellow-800 dark:bg-yellow-500/20 dark:text-yellow-200";
        case "Low":
          return "bg-green-100 text-green-800 dark:bg-green-500/20 dark:text-green-300";
        default:
          return "bg-gray-100 text-gray-800 dark:bg-gray-500/20 dark:text-gray-200";
      }
    }

    // ==========================
    // FIREBASE HELPERS
    // ==========================
    async function firebaseLoadBoard(docId) {
      try {
        if (!docId) {
          console.warn("âš ï¸ firebaseLoadBoard called with empty docId");
          return null;
        }
        console.log("ðŸŒ [Firebase] Loading board:", docId);
        const ref = db.collection("boards").doc(docId);
        const snap = await ref.get();
        if (!snap.exists) {
          console.log("â„¹ï¸ [Firebase] No document yet for board:", docId);
          return null;
        }
        const data = snap.data();
        console.log("âœ… [Firebase] Loaded data for board:", docId, data);
        return data;
      } catch (e) {
        console.error("ðŸ’¥ [Firebase] Load error:", e);
        return null;
      }
    }

    async function firebaseSaveBoard(docId, payload) {
      try {
        if (!docId) {
          console.warn("âš ï¸ firebaseSaveBoard called with empty docId");
          return;
        }
        console.log("ðŸŒ [Firebase] Saving board:", docId, payload);
        const ref = db.collection("boards").doc(docId);
        await ref.set({
          ...payload,
          boardid: docId,
          updatedAt: Date.now()
        });
        console.log("âœ… [Firebase] Saved board:", docId);
      } catch (e) {
        console.error("ðŸ’¥ [Firebase] Save error:", e);
      }
    }

    // ==========================
    // STATE
    // ==========================
    const initialState = {
      darkMode: false,
      currentUser,
      showLogin: !currentUser && !boardid,
      isLoading: false,
      saveStatus: "saved",
      currentView: "list", // "list" | "kanban"

      workspaces: [],
      selectedWorkspace: null,
      projects: [],
      selectedProject: null,
      groups: [],
      tasks: [],

      ui: {
        showNewTask: null,
        newTask: {
          name: "",
          assignee: null,
          priority: "Medium",
          status: "Not Started",
          dueDate: "",
          customFields: {}
        },
        columnsGroupId: null,
        editingWorkspaceId: null,
        editingWorkspaceName: "",
        editingProjectId: null,
        editingProjectName: "",
        editingTaskId: null,
        editingGroupId: null,
        editingGroupName: ""
      }
    };

    let state = { ...initialState };

    // ==========================
    // API + LOCAL STORAGE
    // ==========================
    const api = {
      saveTimer: null,

      load: async () => {
        if (!boardid && !state.currentUser) {
          console.log("âš ï¸ No boardid or currentUser â€“ showing login");
          state.showLogin = true;
          renderApp();
          return;
        }

        state.isLoading = true;
        renderApp();
        console.log("ðŸš€ api.load start. boardid =", boardid, "user =", state.currentUser);

        try {
          const key = getStorageKey();

          // 1) Try localStorage first
          if (key) {
            const stored = localStorage.getItem(key);
            if (stored) {
              console.log("ðŸ“‚ Loaded from localStorage for key:", key);
              try {
                const parsed = JSON.parse(stored);
                if (parsed && typeof parsed === "object") {
                  state.workspaces = parsed.workspaces || [];
                  state.projects   = parsed.projects   || [];
                  state.groups     = parsed.groups     || [];
                  state.tasks      = parsed.tasks      || [];
                  state.currentView = parsed.currentView || "list";
                  state.darkMode    = !!parsed.darkMode;

                  if (state.workspaces.length > 0) {
                    state.selectedWorkspace = state.workspaces[0].id;
                  }
                  if (state.projects.length > 0) {
                    const proj = state.projects.find(
                      p => p.workspaceId === state.selectedWorkspace
                    );
                    state.selectedProject =
                      (proj && proj.id) || state.projects[0].id;
                  }

                  state.isLoading = false;
                  renderApp();
                  return;
                }
              } catch (e) {
                console.warn("localStorage parse error:", e);
              }
            } else {
              console.log("â„¹ï¸ No localStorage data for key:", key);
            }
          }

          // 2) Try Firebase shared board
          try {
            const docId = boardid || (state.currentUser ? state.currentUser.id : "");
            console.log("ðŸŒ Loading from Firebase using docId:", docId);

            const parsed = await firebaseLoadBoard(docId);

            if (parsed && typeof parsed === "object") {
              console.log("âœ… Firebase returned saved state:", parsed);

              state.workspaces = parsed.workspaces || [];
              state.projects   = parsed.projects   || [];
              state.groups     = parsed.groups     || [];
              state.tasks      = parsed.tasks      || [];
              state.currentView = parsed.currentView || "list";
              state.darkMode    = !!parsed.darkMode;

              if (state.workspaces.length > 0) {
                state.selectedWorkspace = state.workspaces[0].id;
              }
              if (state.projects.length > 0) {
                const proj = state.projects.find(
                  p => p.workspaceId === state.selectedWorkspace
                );
                state.selectedProject =
                  (proj && proj.id) || state.projects[0].id;
              }

              // Cache backend data into localStorage
              const key2 = getStorageKey();
              if (key2) {
                try {
                  localStorage.setItem(
                    key2,
                    JSON.stringify({
                      darkMode: state.darkMode,
                      currentView: state.currentView,
                      workspaces: state.workspaces,
                      projects: state.projects,
                      groups: state.groups,
                      tasks: state.tasks
                    })
                  );
                  console.log("ðŸ’¾ Cached Firebase data into localStorage for key:", key2);
                } catch (e) {
                  console.warn("localStorage save failed:", e);
                }
              }

              state.isLoading = false;
              renderApp();
              return;
            } else {
              console.log("â„¹ï¸ No Firebase state found for this board. Using defaults.");
              api.initDefaults();
            }
          } catch (e) {
            console.warn("Firebase load failed, using defaults:", e);
            api.initDefaults();
          }
        } catch (e) {
          console.error("ðŸ’¥ Load exception:", e);
          api.initDefaults();
        } finally {
          state.isLoading = false;
          renderApp();
        }
      },

      initDefaults: () => {
        console.log("ðŸ†• initDefaults called â€“ creating starter workspace/project/groups");
        const wsId = uid();
        const pId = uid();
        const g1 = uid(), g2 = uid(), g3 = uid();

        const defaultColumns = [
          { id: "task", name: "Task", isDefault: true },
          { id: "assignee", name: "Assignee", isDefault: true },
          { id: "priority", name: "Priority", isDefault: true },
          { id: "status", name: "Status", isDefault: true },
          { id: "duedate", name: "Due Date", isDefault: true }
        ];

        state.workspaces = [{ id: wsId, name: "My Workspace" }];
        state.projects = [
          {
            id: pId,
            name: "Marketing Campaign",
            color: "bg-purple-500",
            workspaceId: wsId
          }
        ];
        state.groups = [
          {
            id: g1,
            name: "To Do",
            projectId: pId,
            collapsed: false,
            columns: JSON.parse(JSON.stringify(defaultColumns))
          },
          {
            id: g2,
            name: "In Progress",
            projectId: pId,
            collapsed: false,
            columns: JSON.parse(JSON.stringify(defaultColumns))
          },
          {
            id: g3,
            name: "Done",
            projectId: pId,
            collapsed: false,
            columns: JSON.parse(JSON.stringify(defaultColumns))
          }
        ];
        state.tasks = [];
        state.selectedWorkspace = wsId;
        state.selectedProject = pId;
        state.currentView = "list";

        api.triggerSave();
      },

      triggerSave: () => {
        if (api.saveTimer) clearTimeout(api.saveTimer);
        state.saveStatus = "pending";
        renderStatusIndicator();
        api.saveTimer = setTimeout(api.performSave, 1500);
      },

      performSave: async () => {
        if (!boardid && !state.currentUser) {
          console.warn("âš ï¸ performSave called with no boardid and no user");
          return;
        }

        try {
          state.saveStatus = "saving";
          renderStatusIndicator();

          const payload = {
            darkMode: state.darkMode,
            currentView: state.currentView,
            workspaces: state.workspaces,
            projects: state.projects,
            groups: state.groups,
            tasks: state.tasks
          };

          console.log("ðŸ’¾ performSave payload:", payload);

          // 1) localStorage (per board)
          const key = getStorageKey();
          if (key) {
            try {
              localStorage.setItem(key, JSON.stringify(payload));
              console.log("ðŸ“‚ Saved to localStorage key:", key);
            } catch (e) {
              console.warn("localStorage save failed:", e);
            }
          }

          // 2) Firebase (shared document)
          const docId = boardid || (state.currentUser ? state.currentUser.id : "");
          await firebaseSaveBoard(docId, payload);

          state.saveStatus = "saved";
        } catch (e) {
          console.error("ðŸ’¥ Save exception:", e);
          state.saveStatus = "error";
        } finally {
          renderStatusIndicator();
        }
      }
    };

    // ==========================
    // ACTIONS (same as your code)
    // ==========================
    const actions = {
      toggleTheme: () => {
        state.darkMode = !state.darkMode;
        renderApp();
        api.triggerSave();
      },

      setView: (view) => {
        state.currentView = view;
        renderApp();
        api.triggerSave();
      },

      // Workspaces
      selectWorkspace: (id) => {
        state.selectedWorkspace = id;
        const proj = state.projects.find(p => p.workspaceId === id);
        state.selectedProject = proj ? proj.id : null;
        renderApp();
      },

      addWorkspace: () => {
        const id = uid();
        const ws = { id, name: "New Workspace" };
        state.workspaces.push(ws);
        state.selectedWorkspace = id;
        renderApp();
        api.triggerSave();
      },

      startEditWorkspace: (id) => {
        const ws = state.workspaces.find(w => w.id === id);
        if (!ws) return;
        state.ui.editingWorkspaceId = id;
        state.ui.editingWorkspaceName = ws.name;
        renderApp();
      },

      saveWorkspaceName: (id) => {
        const input = document.getElementById(`ws-name-input-${id}`);
        const ws = state.workspaces.find(w => w.id === id);
        if (ws && input) {
          const val = input.value.trim();
          if (val) ws.name = val;
          api.triggerSave();
        }
        state.ui.editingWorkspaceId = null;
        state.ui.editingWorkspaceName = "";
        renderApp();
      },

      deleteWorkspace: (id) => {
        if (state.workspaces.length <= 1) {
          alert("Cannot delete the last workspace.");
          return;
        }
        state.workspaces = state.workspaces.filter(w => w.id !== id);
        if (state.selectedWorkspace === id) {
          state.selectedWorkspace = state.workspaces[0].id;
        }
        const toRemoveProjects = state.projects
          .filter(p => p.workspaceId === id)
          .map(p => p.id);
        state.projects = state.projects.filter(p => p.workspaceId !== id);
        state.groups = state.groups.filter(g => !toRemoveProjects.includes(g.projectId));
        state.tasks = state.tasks.filter(t => !toRemoveProjects.includes(t.projectId));

        renderApp();
        api.triggerSave();
      },

      // Projects
      addProject: () => {
        if (!state.selectedWorkspace) return;
        const id = uid();
        const proj = {
          id,
          name: "New Project",
          color: "bg.green-500",
          workspaceId: state.selectedWorkspace
        };
        state.projects.push(proj);
        state.selectedProject = id;

        const defaultColumns = [
          { id: "task", name: "Task", isDefault: true },
          { id: "assignee", name: "Assignee", isDefault: true },
          { id: "priority", name: "Priority", isDefault: true },
          { id: "status", name: "Status", isDefault: true },
          { id: "duedate", name: "Due Date", isDefault: true }
        ];

        const g1 = uid(), g2 = uid(), g3 = uid();
        state.groups.push(
          { id: g1, name: "To Do", projectId: id, collapsed: false, columns: JSON.parse(JSON.stringify(defaultColumns)) },
          { id: g2, name: "In Progress", projectId: id, collapsed: false, columns: JSON.parse(JSON.stringify(defaultColumns)) },
          { id: g3, name: "Done", projectId: id, collapsed: false, columns: JSON.parse(JSON.stringify(defaultColumns)) }
        );

        renderApp();
        api.triggerSave();
      },

      selectProject: (id) => {
        state.selectedProject = id;
        renderApp();
      },

      startEditProject: (id) => {
        const p = state.projects.find(pr => pr.id === id);
        if (!p) return;
        state.ui.editingProjectId = id;
        state.ui.editingProjectName = p.name;
        renderApp();
      },

      saveProjectName: (id) => {
        const input = document.getElementById(`proj-name-input-${id}`);
        const p = state.projects.find(pr => pr.id === id);
        if (p && input) {
          const val = input.value.trim();
          if (val) p.name = val;
          api.triggerSave();
        }
        state.ui.editingProjectId = null;
        state.ui.editingProjectName = "";
        renderApp();
      },

      deleteProject: (id) => {
        if (!confirm("Delete project?")) return;
        state.projects = state.projects.filter(p => p.id !== id);
        state.groups = state.groups.filter(g => g.projectId !== id);
        state.tasks = state.tasks.filter(t => t.projectId !== id);

        const nextP = state.projects.find(
          p => p.workspaceId === state.selectedWorkspace
        );
        state.selectedProject = nextP ? nextP.id : (state.projects[0]?.id || null);

        renderApp();
        api.triggerSave();
      },

      // Groups
      toggleGroupCollapse: (id) => {
        const g = state.groups.find(gr => gr.id === id);
        if (!g) return;
        g.collapsed = !g.collapsed;
        renderApp();
        api.triggerSave();
      },

      addGroup: () => {
        if (!state.selectedProject) return;
        const baseGroup =
          state.groups.find(g => g.projectId === state.selectedProject) ||
          state.groups[0];

        const id = uid();
        const newGroup = {
          id,
          name: "New Group",
          projectId: state.selectedProject,
          collapsed: false,
          columns: baseGroup
            ? JSON.parse(JSON.stringify(baseGroup.columns))
            : [
              { id: "task", name: "Task", isDefault: true },
              { id: "assignee", name: "Assignee", isDefault: true },
              { id: "priority", name: "Priority", isDefault: true },
              { id: "status", name: "Status", isDefault: true },
              { id: "duedate", name: "Due Date", isDefault: true }
            ]
        };
        state.groups.push(newGroup);
        renderApp();
        api.triggerSave();
      },

      startEditGroup: (id) => {
        const g = state.groups.find(gr => gr.id === id);
        if (!g) return;
        state.ui.editingGroupId = id;
        state.ui.editingGroupName = g.name;
        renderApp();
      },

      saveGroupName: (id) => {
        const input = document.getElementById(`group-name-input-${id}`);
        const g = state.groups.find(gr => gr.id === id);
        if (g && input) {
          const val = input.value.trim();
          if (val) g.name = val;
          api.triggerSave();
        }
        state.ui.editingGroupId = null;
        state.ui.editingGroupName = "";
        renderApp();
      },

      deleteGroup: (id) => {
        if (!confirm("Delete group?")) return;
        state.groups = state.groups.filter(g => g.id !== id);
        state.tasks = state.tasks.filter(t => t.groupId !== id);
        renderApp();
        api.triggerSave();
      },

      toggleColumnsPanel: (groupId) => {
        state.ui.columnsGroupId =
          state.ui.columnsGroupId === groupId ? null : groupId;
        renderApp();
      },

      addColumn: (groupId) => {
        const g = state.groups.find(gr => gr.id === groupId);
        if (!g) return;
        g.columns.push({
          id: "col_" + uid(),
          name: "New Column",
          isDefault: false
        });
        renderApp();
        api.triggerSave();
      },

      renameColumn: (groupId, colId) => {
        const input = document.getElementById(`col-name-${groupId}-${colId}`);
        if (!input) return;
        const g = state.groups.find(gr => gr.id === groupId);
        if (!g) return;
        const col = g.columns.find(c => c.id === colId);
        if (col) {
          col.name = input.value.trim() || col.name;
          renderApp();
          api.triggerSave();
        }
      },

      deleteColumn: (groupId, colId) => {
        const g = state.groups.find(gr => gr.id === groupId);
        if (!g) return;
        g.columns = g.columns.filter(c => c.id !== colId);
        state.tasks.forEach(t => {
          if (t.customFields && t.customFields[colId] !== undefined) {
            delete t.customFields[colId];
          }
        });
        renderApp();
        api.triggerSave();
      },

      // Tasks
      setShowNewTask: (groupId) => {
        state.ui.showNewTask = groupId;
        state.ui.newTask = {
          name: "",
          assignee: null,
          priority: "Medium",
          status: "Not Started",
          dueDate: "",
          customFields: {}
        };
        renderApp();
      },

      submitTask: (groupId) => {
        const input = document.getElementById(`new-task-name-${groupId}`);
        if (!input || !input.value.trim()) return;
        const id = uid();
        const t = {
          id,
          name: input.value.trim(),
          groupId,
          projectId: state.selectedProject,
          priority: state.ui.newTask.priority || "Medium",
          status: state.ui.newTask.status || "Not Started",
          assignee: null,
          dueDate: "",
          customFields: {}
        };
        state.tasks.push(t);
        state.ui.showNewTask = null;
        renderApp();
        api.triggerSave();
      },

      deleteTask: (id) => {
        state.tasks = state.tasks.filter(t => t.id !== id);
        renderApp();
        api.triggerSave();
      },

      startEditTaskName: (id) => {
        state.ui.editingTaskId = id;
        renderApp();
        const input = document.getElementById(`task-name-input-${id}`);
        if (input) input.focus();
      },

      saveTaskName: (id) => {
        const input = document.getElementById(`task-name-input-${id}`);
        const t = state.tasks.find(task => task.id === id);
        if (t && input) {
          const val = input.value.trim();
          if (val) t.name = val;
          api.triggerSave();
        }
        state.ui.editingTaskId = null;
        renderApp();
      },

      updateTaskField: (id, field, value, extra) => {
        const t = state.tasks.find(task => task.id === id);
        if (!t) return;

        if (field === "assignee") {
          t.assignee = value ? { name: value } : null;
        } else if (field === "custom") {
          const colId = extra;
          if (!t.customFields) t.customFields = {};
          t.customFields[colId] = value;
        } else {
          t[field] = value;
        }
        renderApp();
        api.triggerSave();
      },

      moveTaskToGroup: (id, groupId) => {
        const t = state.tasks.find(task => task.id === id);
        if (!t) return;
        t.groupId = groupId;
        renderApp();
        api.triggerSave();
      }
    };

    window.actions = actions;

    // ==========================
    // RENDER HELPERS
    // (All your existing renderSidebar, renderStatusIndicator,
    //  renderKanbanView, renderListView, renderLogin, renderApp)
    // ==========================
    // I keep them exactly as you provided before, only using the same state/actions.

    function renderStatusIndicator() {
      const el = document.getElementById("save-status");
      if (!el) return;
      let html = "";
      if (state.saveStatus === "saving")
        html =
          '<span class="text-blue-500 flex items-center gap-1"><i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i> Saving...</span>';
      else if (state.saveStatus === "pending")
        html =
          '<span class="text-yellow-500 flex items-center gap-1">Changes pending...</span>';
      else if (state.saveStatus === "error")
        html =
          '<span class="text-red-500 flex items-center gap-1"><i data-lucide="alert-circle" class="w-3 h-3"></i> Save Failed</span>';
      else
        html =
          '<span class="text-green-500 flex items-center gap-1"><i data-lucide="check" class="w-3 h-3"></i> Saved</span>';
      el.innerHTML = html;
      lucide.createIcons();
    }

    /* ------------- 
       renderSidebar, renderColumnsPanel, renderCellForColumn,
       renderKanbanView, renderListView, renderLogin
       (reuse exactly from your existing file â€“ unchanged)
       ------------- */

    // To keep this answer from being 20+ pages, Iâ€™m not repeating
    // every render function here, but you can take them directly
    // from your current working HTML and paste them below this comment
    // exactly as they are. They don't touch Firebase at all.

    // ... PASTE YOUR EXISTING RENDER FUNCTIONS HERE ...

    function renderLogin() {
      return `
        <div class="h-screen flex items-center justify-center bg-gray-100 text-xl text-gray-600">
          Please open WellTask from Zoho Cliq.
        </div>
      `;
    }

    function renderApp() {
      const app = document.getElementById("app");
      if (!app) return;

      if (state.showLogin) {
        app.innerHTML = renderLogin();
      } else {
        document.documentElement.classList.toggle("dark", state.darkMode);
        const bgColor = state.darkMode ? "bg-gray-900" : "bg-gray-50";

        app.innerHTML = `
          <div class="flex h-screen ${bgColor} overflow-hidden font-sans relative">
            ${state.isLoading
              ? `<div class="absolute inset-0 bg-black/20 z-50 flex items-center justify-center">
                     <div class="animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full"></div>
                 </div>`
              : ""
            }
            ${renderSidebar()}
            <div class="flex-1 overflow-hidden">
              ${state.currentView === "kanban"
                ? renderKanbanView()
                : renderListView()
              }
            </div>
          </div>
        `;
        renderStatusIndicator();
      }

      lucide.createIcons();
    }

    // ==========================
    // BOOT
    // ==========================
    console.log("ðŸŸ¢ Boot: boardid =", boardid, "currentUser =", currentUser);
    if (boardid || state.currentUser) {
      api.load();
    } else {
      renderApp();
    }
  </script>
</body>
</html>
